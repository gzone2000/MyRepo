Elasticsearch 설치 및 설정


ㅇ 버젼 : Elasticsearch-6.7.2
ㅇ VirtualBox VM 
   - 1 CPU , 2048M Mem, 20G HDD
   - IP : 192.168.63.101 (Host-Only)
   - IP : 10.0.2.15 (NAT)



0. ubuntu-16.04 이미지 이용하여 VM 생성

	VitualBox > 파일 > 호스트 네트워크 관리자 
		> 어댑터: 수동 IP 주소 : 192.168.63.1
		> DHCP: '서버 사용함' 체크 안함

	Virtualbox > 새로 만들기 > ELK-TEST01 (Linux, Ubuntu-64bit) 
	> 2048M , 20G HDD
	> 네트워크 : 어댑터1 (NAT), 어댑터1 (Host-Only)
	> ubuntu-16.04 이미지 넣고 설치

1. IP 설정 및 계정 생성

	VM > 장치 > 게스트 확장 CD 삽입 
	sudo shutdown -r now

	sudo hostnamectl --static set-hostname ELK01
	sudo vi /etc/hosts
		127.0.0.1	localhost	ELK01

	sudo nmcli d
		DEVICE  TYPE      STATE      CONNECTION         
		enp0s3  ethernet  connected  Wired connection 2 
		enp0s8  ethernet  connected  Wired connection 1 

	sudo nmcli connection modify 'Wired connection 1' ipv4.method manual ipv4.addr '192.168.63.101/24' 
	sudo nmcli connection show 'Wired connection 1' | grep ipv4
	sudo shutdown -r now

	DOS > ping 192.168.63.101

	sudo useradd elas -m -s /bin/bash
	sudo passwd elas

2. sudo 권한

	sudo vi /etc/sudoers
	elas   ALL=(ALL:ALL) ALL
	
3. OpenJDK8 JAVA Download/Unzip 

	sudo su -
	wget https://github.com/ojdkbuild/contrib_jdk8u-ci/releases/download/jdk8u212-b04/jdk-8u212-ojdkbuild-linux-x64.zip
	
	unzip jdk-8u212-ojdkbuild-linux-x64.zip
	mv jdk-8u212-ojdkbuild-linux-x64 jdk8
	mv jdk8/ /usr/local
	/usr/local/jdk8/bin/java -version

4. JAVA_HOME 설정

	su - elas
	vi .profile
	export JAVA_HOME=/usr/local/jdk8
	
	source .profile
	$JAVA_HOME/bin/java -version

5. Elasticsearch Install

	wget https://artifacts.elastic.co/downloads/elasticsearch/elasticsearch-6.7.2.tar.gz
	tar -xzvf elasticsearch-6.7.2.tar.gz

6. 호스트 이름 및 파라미터 설정

	sudo sysctl -w vm.max_map_count=262144
	sudo vi /etc/sysctl.conf
	vm.max_map_count = 262144

7. Elasticsearch start/stop

	cd elasticsearch-6.7.2
	echo 'bin/elasticsearch -d -p es.pid' > start.sh
	echo 'kill -s kill `cat es.pid`' > stop.sh
	chmod 755 start.sh stop.sh

	sudo mkdir -p /ELK/data /ELK/logs
	sudo chown -R elas.elas /ELK

	vi config/elasticsearch.yml
	cluster.name: my-application
	node.name: ${HOSTNAME}
	path.data: /ELK/data
	path.logs: /ELK/logs
	network.host: 192.168.63.101
	#http.port: 9200
	#discovery.zen.ping.unicast.hosts: ["host1", "host2"]
	
	./start.sh
	tail -f /ELK/logs/my-application.log

8. Elasticsearch Check

	ps -ef | grep java
	netstat -na | grep LISTEN | grep 9200

	sudo apt-get install curl
	curl http://192.168.63.101:9200
{
  "name" : "ELK01",
  "cluster_name" : "my-application",
  "cluster_uuid" : "KZssfyX8RDaMmzMv78_WUw",
  "version" : {
    "number" : "6.7.2",
    "build_flavor" : "default",
    "build_type" : "tar",
    "build_hash" : "56c6e48",
    "build_date" : "2019-04-29T09:05:50.290371Z",
    "build_snapshot" : false,
    "lucene_version" : "7.7.0",
    "minimum_wire_compatibility_version" : "5.6.0",
    "minimum_index_compatibility_version" : "5.0.0"
  },
  "tagline" : "You Know, for Search"
}


9. Elasticsearch 웹브라우저에서 보기

	http://192.168.63.101:9200/


10. 정상적으로 되었다면, 해당 상태를 이미지 복사하고 셋팅 >>  ELK-TEST02, ELK-TEST03 VM 생성

	sudo shutdown -h now
	
	VitualBox > ELK-TEST01 선택 > 복제 : ELK-TEST02
	> 'MAC 주소 초기화' 체크 
	> 완전한 복제

	VitualBox > ELK-TEST01 선택 > 복제 : ELK-TEST03
	> 'MAC 주소 초기화' 체크 
	> 완전한 복제



	# ELK-TEST02
	VitualBox > ELK-TEST02 선택 > 기동

	sudo hostnamectl --static set-hostname ELK02
	sudo vi /etc/hosts
		127.0.0.1	localhost	ELK02

	sudo nmcli d
		DEVICE  TYPE      STATE      CONNECTION         
		enp0s3  ethernet  connected  Wired connection 2 
		enp0s8  ethernet  connected  Wired connection 1 

	sudo nmcli connection modify 'Wired connection 1' ipv4.method manual ipv4.addr '192.168.63.102/24' 
	sudo nmcli connection show 'Wired connection 1' | grep ipv4
	sudo shutdown -r now

	DOS > ping 192.168.63.102



	# ELK-TEST03
	VitualBox > ELK-TEST03 선택 > 기동

	sudo hostnamectl --static set-hostname ELK03
	sudo vi /etc/hosts
		127.0.0.1	localhost	ELK03

	sudo nmcli d
		DEVICE  TYPE      STATE      CONNECTION         
		enp0s3  ethernet  connected  Wired connection 2 
		enp0s8  ethernet  connected  Wired connection 1 

	sudo nmcli connection modify 'Wired connection 1' ipv4.method manual ipv4.addr '192.168.63.103/24' 
	sudo nmcli connection show 'Wired connection 1' | grep ipv4
	sudo shutdown -r now

	DOS > ping 192.168.63.103




